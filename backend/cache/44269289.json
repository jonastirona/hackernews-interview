{"hn_id": "44269289", "title": "The Hat, the Spectre and SAT Solvers (2024)", "url": "https://news.ycombinator.com/item?id=44269289", "article_url": "https://www.nhatcher.com/post/on-hats-and-sats/", "points": 54, "author": "todsacerdoti", "comments_count": 4, "time": 0, "full_article_html": "<main class=\"wrapper__main\">\n<header class=\"header\"><div class=\".\">\n<a aria-expanded=\"false\" aria-label=\"menu\" class=\"navbar-burger\" data-target=\"navMenu\" role=\"button\">\n<span aria-hidden=\"true\" class=\"navbar-burger__line\"></span>\n<span aria-hidden=\"true\" class=\"navbar-burger__line\"></span>\n<span aria-hidden=\"true\" class=\"navbar-burger__line\"></span>\n</a>\n<nav class=\"nav\">\n<ul class=\"nav__list\" id=\"navMenu\">\n<li class=\"nav__list-item\">\n<a href=\"https://www.nhatcher.com/\" title=\"\">Home</a>\n</li>\n<li class=\"nav__list-item\">\n<a href=\"https://www.nhatcher.com/post/\" title=\"\">Posts</a>\n</li>\n<li class=\"nav__list-item\">\n<a href=\"https://www.nhatcher.com/about/\" title=\"\">About</a>\n</li>\n</ul>\n<ul class=\"nav__list nav__list--end\">\n<li class=\"nav__list-item\">\n<div class=\"themeswitch\">\n<a title=\"Switch Theme\">\n<i aria-hidden=\"true\" class=\"fas fa-adjust fa-fw\"></i>\n</a>\n</div>\n</li>\n</ul>\n</nav>\n</div>\n</header>\n<div class=\"post .\">\n<div class=\"post__content\">\n<h1>The Hat, the Spectre and SAT Solvers</h1>\n<ul class=\"post__meta\">\n<li class=\"post__meta-item\">\n<em class=\"fas fa-calendar-day post__meta-icon\"></em>\n<span class=\"post__meta-text\">\nSat, Jan 27, 2024\n</span>\n</li>\n<li class=\"post__meta-item\">\n<em class=\"fas fa-stopwatch post__meta-icon\"></em>\n<span class=\"post__meta-text\">16-minute read</span>\n</li>\n</ul>\n<h1 id=\"introduction\">Introduction</h1>\n<p>In this blog post you are going to read about two things:</p>\n<ul>\n<li>A new flashy discovery in mathematics: aperiodic tilings of the plane with a single monotile</li>\n<li>SAT solvers. A family of not so well known algorithms in computer science</li>\n</ul>\n<p>Hopefully by the end of the post you will know a fair amount about the hat, the turtle and the spectres and have another powerful tool under your belt, SAT solvers.</p>\n<p>Thus, you can see this post either as an exercise in recreational mathematics or as an invitation to SAT solvers.</p>\n<p>The post is organized as follows. We first introduce the Hat and state the main result. Then we define what SAT solvers are. In section 3 we describe how we use the solver in wasm and apply it to the problem of solving a Sudoku problem as a warm up exercise in the next section. In section 5 we explain Craig Kaplan’s idea of how to use SAT solvers to tile finite regions of the plane and apply it to the Hat. Section 6 introduces the Turtle, a second monotile capable of tiling the plane aperiodically. With all those constructions we build the Spectre, from deformations of Hats and Turtles, a true chiral aperiodic monotile. In the last section we explain how to use the <a href=\"https://www.nhatcher.com/hats/\">app</a></p>\n<h1 id=\"code\">Code</h1>\n<p>You can find all the code discussed here in <a href=\"https://github.com/nhatcher/hats\">GitHub</a>.</p>\n<p>There is an app you can play along with at:</p>\n<p><a href=\"https://www.nhatcher.com/hats/\">https://www.nhatcher.com/hats/</a></p>\n<p>The sudoku solver mentioned below is deployed at:</p>\n<p><a href=\"https://www.nhatcher.com/hats/sudoku.html\">https://www.nhatcher.com/hats/sudoku.html</a></p>\n<p>A small app solving general SAT problems in the browser:</p>\n<p><a href=\"https://www.nhatcher.com/hats/sat.html\">https://www.nhatcher.com/hats/sat.html</a></p>\n<p>I used the fantastic <a href=\"https://github.com/shnarazk/splr\">dplr</a> SAT Solver by <a href=\"https://github.com/shnarazk\">Shuji Narazaki</a> and adapted it to wasm in:</p>\n<p><a href=\"https://github.com/nhatcher/splr-wasm\">https://github.com/nhatcher/splr-wasm</a></p>\n<h1 id=\"1-the-hat-a-shape-perplexing-the-world\">1. The Hat: a shape perplexing the world</h1>\n<p>It is quite unusual that a discovery in mathematics is understandable by the general public, but 2023 witnessed precisely that.</p>\n<p>In November of 2022 just as ChatGPT was going to take world by a storm, <a href=\"https://en.wikipedia.org/wiki/David_Smith_(amateur_mathematician)\">David Smith</a> a retired printer technician and amateur mathematician found a shape:</p>\n<p><img alt=\"the hat\" class=\"medium-zoom-image\" data-src=\"https://www.nhatcher.com/images/hats/hat.png\" loading=\"lazy\" onerror=\"this.style.display='none'\" src=\"https://www.nhatcher.com/images/hats/hat.png\" title=\"The Hat\"/></p>\n<p>Thats is able to <em>tile</em> the whole infinite plane in a non periodic way:</p>\n<p><img alt=\"tilling\" class=\"medium-zoom-image\" data-src=\"https://www.nhatcher.com/images/hats/simple-tilling.png\" loading=\"lazy\" onerror=\"this.style.display='none'\" src=\"https://www.nhatcher.com/images/hats/simple-tilling.png\" title=\"simple tilling\"/></p>\n<p>The announcement was made in a <a href=\"https://arxiv.org/abs/2303.10798\">paper</a> but you might have heard of it in any of your favorite channels like <a href=\"https://www.youtube.com/watch?v=48sCx-wBs34\">veritasium</a>, <a href=\"https://www.youtube.com/watch?v=_ZS3Oqg1AX0\">numberphile</a>,\n<a href=\"https://www.quantamagazine.org/hobbyist-finds-maths-elusive-einstein-tile-20230404/\">quanta magazine</a> or even the\n<a href=\"https://www.nytimes.com/2023/03/28/science/mathematics-tiling-einstein.html\">New York Times</a>.</p>\n<p>The story of non periodic tilings of the plane is somewhat old and was popularized by Sir Roger Penrose and Martin Gadner in his famous Scientific American column on recreational mathematics. For example Penrose found <a href=\"https://en.wikipedia.org/wiki/Penrose_tiling\">two tiles</a> (the dart and the kite) that were able to tile the plane in a non periodic way.</p>\n<p>In this blog post I will write a bit about these new tilings of the plane and how to cover finite regions using an algorithm that not many people, even people in the industry, know: a SAT solver.</p>\n<h1 id=\"2-the-sat-solver-an-underappreciated-tool\">2. The SAT solver, an underappreciated tool.</h1>\n<p>A <a href=\"https://en.wikipedia.org/wiki/SAT_solver\">SATisfiability solver</a> is a computer program that solves problems in boolean algebra. Say you have a number of variables <code>a</code>, <code>b</code>, <code>c</code> , <code>d</code>, … that can be either <strong>true</strong> or <strong>false</strong>. And then you have a series of statements regarding those variables, like:</p>\n<ul>\n<li>If <code>a</code> is <strong>true</strong> then either <code>b</code> is <strong>true</strong> or <code>c</code> is <strong>false</strong>.</li>\n<li>If <code>a</code> and <code>b</code> are both <strong>true</strong> if and only if <code>d</code> or <code>c</code> is false.</li>\n</ul>\n<p>Solvers can deal with problems with a lot of variables. We will run some experiments in your browser with more than 60 thousand variables and millions of statements.</p>\n<p>To be able to use the solver we first need to convert all of our logic statements in what is called a <strong><a href=\"https://en.wikipedia.org/wiki/Conjunctive_normal_form\">conjunctive normal form</a></strong> (CNF). We don’t really need to explain much in here because as it happens the statements that we will produce are exactly in this form already.</p>\n<p>In <em>conjunctive normal form</em> we have a series of statements, called <em>clauses</em>, that all need to be true (those are the conjunction or AND blocks). Each clause is composed of an OR array of literals (variables and their negations). For example:</p>\n<ul>\n<li>a or b or not c</li>\n<li>a or d</li>\n<li>not c or d</li>\n</ul>\n<p>This is composed of 3 clauses and there are 4 variables (a, b, c , d).</p>\n<p>There is a general constructive theorem called the <em>Tseitin transformation</em> that converts any problem in boolean logic to an equivalent in CNF.</p>\n<p>As I said, in our case the problem will already be in CNF so we don’t need to bother about that. The next step will be to write the problem in a way a Solver can digest it. The standard way is to assign a positive to each variable. For instance</p>\n<ul>\n<li>a -&gt; 1</li>\n<li>b -&gt; 2</li>\n<li>c -&gt; 3</li>\n<li>d -&gt; 4</li>\n</ul>\n<p>The each clause is an array:</p>\n<ul>\n<li>a or b or not c &lt;=&gt; [1, 2, -3]</li>\n</ul>\n<p>As a you can see a negative value means negation of the variable.</p>\n<p>Once you feed the solver an array of arrays it returns an array like [1, -2, 3, -4] that means variable 1 and 3 are true and variables 2 and 4 are false. The solver might not find a solution and will return an error or might be able to prove that there is not a valid a solution and will return “UNSAT”.</p>\n<h1 id=\"3-a-sat-solver-in-wasm\">3. A SAT Solver in wasm</h1>\n<p>There are a million SAT solvers out there but we will use <a href=\"https://github.com/shnarazk/splr\">splr</a> that we can compile to <a href=\"https://github.com/nhatcher/splr-wasm\">WASM</a>, fits into a 200kB file and runs in the <a href=\"https://www.nhatcher.com/hats/sat.html\">browser</a>.</p>\n<p>Since we are communicating with wasm instead of passing an array of arrays to the solver we will pass just one array from which you can rebuild the array of arrays:</p>\n<div class=\"highlight\"><pre class=\"chroma\" tabindex=\"0\"><code class=\"language-fallback\" data-lang=\"fallback\"><span class=\"line\"><span class=\"cl\">[(length, a_1, ..., a_l)*]\n</span></span></code></pre></div><p>So, for instance the array of arrays:</p>\n<div class=\"highlight\"><pre class=\"chroma\" tabindex=\"0\"><code class=\"language-fallback\" data-lang=\"fallback\"><span class=\"line\"><span class=\"cl\">[\n</span></span><span class=\"line\"><span class=\"cl\">    [5, -4, 7],\n</span></span><span class=\"line\"><span class=\"cl\">    [3, -5, 89, 3]\n</span></span><span class=\"line\"><span class=\"cl\">]\n</span></span></code></pre></div><p>Will be converted to:</p>\n<div class=\"highlight\"><pre class=\"chroma\" tabindex=\"0\"><code class=\"language-javascript\" data-lang=\"javascript\"><span class=\"line\"><span class=\"cl\"><span class=\"kr\">const</span> <span class=\"nx\">array</span> <span class=\"o\">=</span> <span class=\"p\">[</span><span class=\"mi\">3</span><span class=\"p\">,</span> <span class=\"mi\">5</span><span class=\"p\">,</span> <span class=\"o\">-</span><span class=\"mi\">4</span><span class=\"p\">,</span> <span class=\"mi\">7</span><span class=\"p\">,</span> <span class=\"mi\">4</span><span class=\"p\">,</span> <span class=\"mi\">3</span><span class=\"p\">,</span> <span class=\"o\">-</span><span class=\"mi\">5</span><span class=\"p\">,</span> <span class=\"mi\">89</span><span class=\"p\">,</span> <span class=\"mi\">3</span><span class=\"p\">]</span>\n</span></span></code></pre></div><p>Once you have the array you pass it to the splr solver by</p>\n<div class=\"highlight\"><pre class=\"chroma\" tabindex=\"0\"><code class=\"language-javascript\" data-lang=\"javascript\"><span class=\"line\"><span class=\"cl\"><span class=\"kr\">const</span> <span class=\"nx\">result</span> <span class=\"o\">=</span> <span class=\"nx\">JSON</span><span class=\"p\">.</span><span class=\"nx\">parse</span><span class=\"p\">(</span><span class=\"nx\">solveSat</span><span class=\"p\">(</span><span class=\"nx\">array</span><span class=\"p\">));</span>\n</span></span></code></pre></div><p>The <code>result</code> will either be successful and contain a <code>data</code> array or fail and have a <code>details</code> message. If it succeeds the <code>result.data</code> will be an array with all the numbers of the variables being either positive (meaning they are true) or negative (meaning they are false).</p>\n<p>To sum up if you want to solve a problem in boolean logic you need:</p>\n<ul>\n<li>Step 1: Convert the problem to a CNF</li>\n<li>Step 2: Number all variables</li>\n<li>Step 3: Create the array of array of clauses</li>\n<li>Step 4: Convert them to a single array and feed it to <code>solveSat</code></li>\n<li>Step 5: Read the output from <code>result.data</code></li>\n<li>Step 6: Convert each of the indices to variables</li>\n</ul>\n<h1 id=\"4-intermezzo-using-a-sat-solver-to-solve-sudokus\">4. Intermezzo: Using a SAT solver to solve Sudokus</h1>\n<p>Instead of jumping right at the main issue let’s use the algorithm to solve a <em>different</em> problem.</p>\n<p>Let’s solve a <a href=\"https://en.wikipedia.org/wiki/Sudoku\">sudoku</a>:</p>\n<p><img alt=\"sudoku\" class=\"medium-zoom-image\" data-src=\"https://www.nhatcher.com/images/hats/sudoku_wikipedia.svg\" loading=\"lazy\" onerror=\"this.style.display='none'\" src=\"https://www.nhatcher.com/images/hats/sudoku_wikipedia.svg\" title=\"A sudoku board\"/></p>\n<p>There are 81 squares on a sudoku board and any number from 1 to 9 can be in any of those squares.</p>\n<p>Our variables are:</p>\n<ul>\n<li>The is a number <code>n</code> in square (row, column)</li>\n</ul>\n<p>where n in [1, .., 9] and row, column in [0, .., 8]</p>\n<p>There are 9x9x9 = 729 variables in total and only 81 of them can be true.\nWe need to index each variable, so the previous statement (“There is an n in square (row, column)”) is the variable number:</p>\n<div class=\"highlight\"><pre class=\"chroma\" tabindex=\"0\"><code class=\"language-fallback\" data-lang=\"fallback\"><span class=\"line\"><span class=\"cl\">index = row*9*9+column*9+n\n</span></span></code></pre></div><p>We also need a way to get (row, column) and n from the index:</p>\n<div class=\"highlight\"><pre class=\"chroma\" tabindex=\"0\"><code class=\"language-javascript\" data-lang=\"javascript\"><span class=\"line\"><span class=\"cl\"><span class=\"kr\">const</span> <span class=\"nx\">fromIndexToCell</span> <span class=\"o\">=</span> <span class=\"p\">(</span><span class=\"nx\">index</span><span class=\"p\">)</span> <span class=\"p\">=&gt;</span> <span class=\"p\">{</span>\n</span></span><span class=\"line\"><span class=\"cl\">    <span class=\"kr\">const</span> <span class=\"nx\">row</span> <span class=\"o\">=</span> <span class=\"nb\">Math</span><span class=\"p\">.</span><span class=\"nx\">floor</span><span class=\"p\">((</span><span class=\"nx\">index</span> <span class=\"o\">-</span> <span class=\"mi\">1</span><span class=\"p\">)</span> <span class=\"o\">/</span> <span class=\"mi\">81</span><span class=\"p\">);</span>\n</span></span><span class=\"line\"><span class=\"cl\">    <span class=\"kr\">const</span> <span class=\"nx\">column</span> <span class=\"o\">=</span> <span class=\"nb\">Math</span><span class=\"p\">.</span><span class=\"nx\">floor</span><span class=\"p\">((</span><span class=\"nx\">index</span> <span class=\"o\">-</span> <span class=\"mi\">1</span> <span class=\"o\">-</span> <span class=\"nx\">row</span> <span class=\"o\">*</span> <span class=\"mi\">81</span><span class=\"p\">)</span> <span class=\"o\">/</span> <span class=\"mi\">9</span><span class=\"p\">);</span>\n</span></span><span class=\"line\"><span class=\"cl\">    <span class=\"kr\">const</span> <span class=\"nx\">n</span> <span class=\"o\">=</span> <span class=\"nx\">index</span> <span class=\"o\">-</span> <span class=\"nx\">row</span> <span class=\"o\">*</span> <span class=\"mi\">81</span> <span class=\"o\">-</span> <span class=\"nx\">column</span> <span class=\"o\">*</span> <span class=\"mi\">9</span><span class=\"p\">;</span>\n</span></span><span class=\"line\"><span class=\"cl\">    <span class=\"k\">return</span> <span class=\"p\">{</span> <span class=\"nx\">row</span><span class=\"p\">,</span> <span class=\"nx\">column</span><span class=\"p\">,</span> <span class=\"nx\">n</span> <span class=\"p\">};</span>\n</span></span><span class=\"line\"><span class=\"cl\"><span class=\"p\">}</span>\n</span></span></code></pre></div><p>Now we need to create all the clauses. For instance, One of the following must be true</p>\n<ul>\n<li>number 1 is in (row=0, column=0)</li>\n<li>number 1 is in (row=0, column=1)\n…</li>\n<li>number 1 is in (row=0, column=8)\nThat’s one clause. We have 9 of those, one for each number <code>n</code>. But of course we have 9 rows. So we have 81 of those.</li>\n</ul>\n<p>We can do the same in columns, so we have 81 clauses for columns.</p>\n<p>We should do that again for every 3x3 block, another 81 clauses.</p>\n<p>That’s 81x3=243 clauses.</p>\n<p>We still need more clauses. One solution of all the previous clauses is make all of them true.</p>\n<p>On each square there can only be a number. For instance:</p>\n<ul>\n<li>NOT(number 1 is in (row=3, column=4))</li>\n<li>NOT(number 2 is in (row=3, column=4))</li>\n</ul>\n<p>For each spot there are (9x8)/2=36 clauses (combinations of 9 elements taken 2 by 2, order is not important).\nThere are 81 spots so that is a total of 81x36=2916 clauses of this kind for a grand total of:</p>\n<p>2916 + 243 = 3159</p>\n<p>Clauses. That is, of course for an empty sudoku board. We will need to add the known numbers. In the diagram above:</p>\n<ul>\n<li>There is a 5 in position (row=0, column=0)\n…</li>\n<li>There is a 9 in position (row=8, column=8)</li>\n</ul>\n<p>That is 30 more clauses for that particular puzzle. For a general sudoku with a single solution it is known that you need at least 17 hints.</p>\n<p>If you want to see the details look at the <a href=\"https://github.com/nhatcher/hats/blob/main/sudoku.js\">source code</a> to see how you can generate all those in just a few lines of simple code.</p>\n<p>Now, using a SAT solver to find solutions to sudokus might not be the most performant algorithm. Also the most important bit is how you <em>generate</em> solutions. I enjoyed reading this <a href=\"https://eli.thegreenplace.net/2022/sudoku-go-and-webassembly/\">piece</a> from the beautiful blog of Eli Bendersky.</p>\n<h1 id=\"5-using-a-sat-solver-to-find-solutions-to-the-tiling-problem\">5. Using a SAT solver to find solutions to the tiling problem</h1>\n<p>In his book “The Art of Computer Programming” in volume 4B Donald Knuth proposes as an (easy) exercise to the reader to find solutions to <em>tatami tilings</em> using a SAT solver.</p>\n<p>Besides that, it was Craig Kaplan’s paper of the <a href=\"https://arxiv.org/abs/2105.09438\">Heesch Numbers of Unmarked Polyforms</a> that used SAT solvers extensively to solve tiling problems (see also his <a href=\"https://isohedral.ca/heesch-numbers-of-unmarked-polyforms\">blog post</a>)</p>\n<p>Given a shape (like the Hat above) or a plolyomio below:</p>\n<p><img alt=\"Fontaine\" class=\"medium-zoom-image\" data-src=\"https://www.nhatcher.com/images/hats/Fontaine.svg\" loading=\"lazy\" onerror=\"this.style.display='none'\" src=\"https://www.nhatcher.com/images/hats/Fontaine.svg\" title=\"Fontaine Polyomio\"/></p>\n<p>The <a href=\"https://en.wikipedia.org/wiki/Heesch%27s_problem\">Heesch number</a> is the number of times you can surround\nthe original shape with copies of it without gaps or overlaps. For instance the <a href=\"https://core.ac.uk/reader/82160310\">Fontaine polyomino</a></p>\n<p><img alt=\"Fontaine Heesch\" class=\"medium-zoom-image\" data-src=\"https://www.nhatcher.com/images/hats/Fontaine_heesch_2.svg\" loading=\"lazy\" onerror=\"this.style.display='none'\" src=\"https://www.nhatcher.com/images/hats/Fontaine_heesch_2.svg\" title=\"Fountaine Heesch\"/>\n(credit wikipedia)</p>\n<p>A <a href=\"https://en.wikipedia.org/wiki/Polyomino\">polyomino</a> is a shape that is made from squares of the same size (like tetris figures or <em>tetraminoes</em>). When you are trying to tile the plane with polyominos the vertices can only be on a square grid. This converts the tiling problem of a finite part of the plane into a combinatorial problem and from there Kaplan was able to produce a set of clauses for a SAT solver.</p>\n<p>The particular shape that David Smith found, the Hat, is not a polyomino but one of it’s vertices must be in the center of an hexagon of a regular hexagonal grid:</p>\n<p><img alt=\"the marked hat\" class=\"medium-zoom-image\" data-src=\"https://www.nhatcher.com/images/hats/hat-marked.png\" loading=\"lazy\" onerror=\"this.style.display='none'\" src=\"https://www.nhatcher.com/images/hats/hat-marked.png\" title=\"The marked Hat\"/></p>\n<p>You can go ahead and play with it at the <a href=\"https://www.nhatcher.com/hats/\">app</a>.</p>\n<p>Note also a very important fact of the Hat. In it composed of a series of 8 “kites”:</p>\n<p><img alt=\"the hat with kites\" class=\"medium-zoom-image\" data-src=\"https://www.nhatcher.com/images/hats/hat_with_kites.svg\" loading=\"lazy\" onerror=\"this.style.display='none'\" src=\"https://www.nhatcher.com/images/hats/hat_with_kites.svg\" title=\"The Hat with Kites\"/></p>\n<p>Much like a polyomino is a <a href=\"https://en.wikipedia.org/wiki/Polyform\">polyform</a> of squares, the Hat is a polyform of <a href=\"https://en.wikipedia.org/wiki/Kite_(geometry)\">kites</a>. This fact will be extremely useful for us.</p>\n<p>You can rotate the shape and all the vertices of the Hat will still be on the grid. There are in total 6 possible rotations. But you can also have the mirror image of the Hat (the anti-Hat), in the app just press the space bar to get an anti-Hat. In each center of an hexagon you can have any of the 12 possibilities:</p>\n<ul>\n<li>Any of the 6 rotations of the Hat</li>\n<li>Any of the 6 rotations of the anti-Hat</li>\n</ul>\n<p>In a grid of <code>M</code> columns and N rows we have <code>12×M×N</code> variables:</p>\n<ul>\n<li>There is Hat (or an anti-Hat) in vertex (m, n) with rotation <code>60×i</code> (with i=0,..,5)</li>\n</ul>\n<p>If we solve for all those variables, i.e. if we decide which of those statements are true and which are false we will find a tiling of the <code>N×M</code> rectangle with Hats and anti-Hats.</p>\n<p>All we need to transform this problem into a something a SAT solver can use is to find a set of clauses.</p>\n<p>The clauses are:</p>\n<ul>\n<li>There cannot be two tiles in the same location</li>\n<li>Two tiles cannot collide</li>\n<li>Every kite must be occupied</li>\n</ul>\n<p>None of those are difficult to build in terms of our variables but some require a bit of geometry.</p>\n<p>For a different take on the same problem see <a href=\"https://www.hgreer.com/HatTile/\">Hastings Greer’s post</a> using Microsoft’s <a href=\"https://github.com/Z3Prover/z3\">z3 theorem prover</a>.</p>\n<h1 id=\"6-its-turtles-all-the-way-down\">6. It’s turtles all the way down</h1>\n<p>A little after finding the Hat, David Smith found another shape:</p>\n<p><img alt=\"the turtle\" class=\"medium-zoom-image\" data-src=\"https://www.nhatcher.com/images/hats/turtle.png\" loading=\"lazy\" onerror=\"this.style.display='none'\" src=\"https://www.nhatcher.com/images/hats/turtle.png\" title=\"The Turtle\"/></p>\n<p>This is called “the Turtle” and it is very similar to the Hat. It also tiles the whole plane in an aperiodic way. All the technology we applied to the Hat, works here as well.</p>\n<p>They soon realized that the Hat and the Turtle are all shapes from the same family.</p>\n<p>Take a Hat. There are two kinds of sides, some of length <code>a</code>, the short ones and some of length <code>b=a*√3</code>. there is one side that is <code>2xa</code>, we will count that as two sides of length <code>a</code>. Now mentally remove the grid behind it and, while preserving the angles, change the length <code>a</code> and <code>b</code>. All the tiles that you generate that way will also tile the whole plane. They call those tiles <code>Tile(a, b)</code>. In this way <code>Tile(1, √3)</code> is the Hat and <code>Tile(√3, 1)</code> is the Turtle.</p>\n<p>Both Hats and Turtles are polykites, but that is not true for other members in the family. What is even more interesting, you can combine Hats and Turtles to tile the plane.</p>\n<p>This last fact would prove fundamental for our next step.</p>\n<p>You can play in the <a href=\"https://www.nhatcher.com/hats/\">app</a> with Hats, anti-Hats, Turtles and anti-Turtles, color them differently, and using the SAT solver to create interesting patterns.</p>\n<h1 id=\"7-the-spectre\">7. The spectre</h1>\n<p>Here is where things get a little bit more involved, the Hat, or the Turtle by themselves do not tile the whole plane. you also need the anti-Hat or the anti-Turtle. Some people felt that that is not really a solution to the <a href=\"https://en.wikipedia.org/wiki/Einstein_problem\">einstein problem</a>.</p>\n<p>The authors of the Hat realized in a <a href=\"https://arxiv.org/abs/2305.17743\">subsequent paper</a> that one member of the family, the <code>Tile(1, 1)</code> does tile the whole plane in an aperiodic way without the need of an <code>anti-Tile(1, 1)</code>. The tile, and its variations were christened the Spectre (technically they call it Tile(1, 1) and call Spectres some variations of it, for us Tile(1, 1) will be the Spectre.):</p>\n<p><img alt=\"the spectre\" class=\"medium-zoom-image\" data-src=\"https://www.nhatcher.com/images/hats/spectre.png\" loading=\"lazy\" onerror=\"this.style.display='none'\" src=\"https://www.nhatcher.com/images/hats/spectre.png\" title=\"The Spectre\"/></p>\n<p>The Spectre, however, does not share the nice properties of its siblings the Hat and the Turtle:</p>\n<ul>\n<li>It does not live in an hexagonal grid</li>\n<li>It is not made out of kites (It is actually not a polyform)</li>\n</ul>\n<p>We can’t really apply a SAT solver directly to this tile. The great insight of the exceptional team is <a href=\"https://arxiv.org/abs/2305.17743\">Theorem 3.1 in the paper</a>:</p>\n<p><strong>Theorem 3.1.</strong> (David Smith, Joseph Samuel Myers, Craig S. Kaplan and Chaim Goodman-Strauss)</p>\n<pre><code>There is a bijection between combinatorially equivalent tilings by Tile(1, 1) and\nby the set {hat, turtle}, such that a Tile(1, 1) tiling has a translation as a symmetry if and only\nif the corresponding hat-turtle tiling has a corresponding translation, and the Tile(1, 1) tiling\nincludes a reflected tile if and only if the hat-turtle tiling does.\n</code></pre>\n<p>If you are not mathematically oriented don’t run just yet. This is a fairly easy to understand statement once we distill it into common English. If I start with a Hat and change the length of it’s sides until they are all the same I will get the Spectre. The inverse transformation, that is starting with the Tile(1, 1) you can change the length of some of the sides and get either a Hat, an anti-Hat, a Turtle or an anti-Turtle. That’s all that theorem is saying. The only tricky bit is to know what sides to change. Note that the tiles have edges that are parallel in pairs. The team called some even and some odd depending on the initial rotation of the spectre, then change the even and odd lengths differently.</p>\n<p><img alt=\"paper\" class=\"medium-zoom-image\" data-src=\"https://www.nhatcher.com/images/hats/paper.png\" loading=\"lazy\" onerror=\"this.style.display='none'\" src=\"https://www.nhatcher.com/images/hats/paper.png\" title=\"Deformations of hats and turtles\"/>\n(from “A chiral aperiodic monotile”)</p>\n<p>There is not better way to see that than through direct manipulation on the <a href=\"https://www.nhatcher.com/hats/\">app</a></p>\n<p>If you start with a <a href=\"https://en.wikipedia.org/wiki/Tessellation\">tessellation</a> of Hats and Turtles alone (no anti-Hats and no anti-Turtles) and you change the side of the edges to be the same you will end up with only Spectres (and no anti-Spectres!). That’s the Einstein, that is the monotile. They got it!</p>\n<p>They went even a little bit further. It turns out that the Spectre and the anti-Spectre also tile the plane but they can do it in a periodic way. Although I won’t go into the details here, modifying the shape of the sides in a symmetrical way will get you shapes that tile the plane only in non periodic ways and you can’t use the anti-Shape.</p>\n<h1 id=\"8-using-the-hats-app\">8. Using the Hats app</h1>\n<p>You might be using the app either to follow along the blog post and understand little bits amd pieces here and there.</p>\n<p>The app is composed of a toolbar with some minimal options, the full canvas and a status bar with some info on what is selected</p>\n<h2 id=\"adding-tiles-manually\">Adding tiles manually</h2>\n<p>You can add as many tiles manually as you want. If you have a keyboard, click ‘A’ to add a new tile, ‘Space’ to cycle through the different types of tiles (Hats, anti-Hats, Turtles and anti-Turtles), ‘R’ to rotate a shape. You can click on ‘Help’ to get this and further instructions. There are also ‘On Screen Controls’ if you don’t have a keyboard.</p>\n<p>Adding tiles manually is a fun way to try to tile the plane by yourself.</p>\n<h2 id=\"tiles-menu\">Tiles menu</h2>\n<p>In the <em>tiles</em> menu you can select what tiles to use and pick different colors for different orientations of each tile.</p>\n<h2 id=\"grid-menu\">Grid menu</h2>\n<p>Here you can choose the number of columns in the grid, and wether or not to show the subjacent hexagon grid.</p>\n<h2 id=\"solver-menu\">Solver menu</h2>\n<p>Once you are happy with a pattern that you have build manually you can use the SAT solver to fill the rest of the available area. If you check “Randomize” the order of the clauses will be randomized before sending them to the solver (As far as I now there is not an option for randomized solutions in this particular solver)</p>\n<p>Modern laptops or even phones can solve in a few seconds problems with ~35 columns and two different tiles. A good laptop can solve problems with ~75 columns and the four tiles in an hour or so. This amounts to 5.5 million clauses!</p>\n<p>You can use the app to test if a particular pattern can appear in the full tilling. For instance can four Hats:</p>\n<p><img alt=\"four hats\" class=\"medium-zoom-image\" data-src=\"https://www.nhatcher.com/images/hats/fourhats.png\" loading=\"lazy\" onerror=\"this.style.display='none'\" src=\"https://www.nhatcher.com/images/hats/fourhats.png\" title=\"Four Hats\"/></p>\n<p>appear in a full tiling of the plane. The answer is no :)</p>\n<h2 id=\"spectres\">Spectres</h2>\n<p>To draw the spectres and other members in the family <code>Tile(a , b)</code>. Go to the “Spectres” menu and click the checkbox “Draw Spectres”. Remember that spectres and other elements in <code>Title(a, b)</code> family do not belong in a grid so there is no straightforward way to draw them. We use a recursive algorithm:</p>\n<ul>\n<li>Start drawing one tile.</li>\n<li>If at a particular vertex there are other tiles, draw them first</li>\n<li>Continue until you are done.</li>\n</ul>\n<p>That will draw a connected component. If you have several disjoint tiles the algorithm will only draw one. Also if the tiles are in a wrong position the algorithm will produce weird results:</p>\n<p><img alt=\"wrong tiles\" class=\"medium-zoom-image\" data-src=\"https://www.nhatcher.com/images/hats/wrong_tiles.png\" loading=\"lazy\" onerror=\"this.style.display='none'\" src=\"https://www.nhatcher.com/images/hats/wrong_tiles.png\" title=\"Wrong tiles\"/>\n<img alt=\"wrong spectres\" class=\"medium-zoom-image\" data-src=\"https://www.nhatcher.com/images/hats/wrong_spectres.png\" loading=\"lazy\" onerror=\"this.style.display='none'\" src=\"https://www.nhatcher.com/images/hats/wrong_spectres.png\" title=\"Wrong spectres\"/></p>\n<p>But if you do everything alright you should find a nice tiling with tiles of your chosen family.</p>\n<p>Note that in general you will have up to 4 different kinds of tiles for each tilling. But when you choose spectres you will have only two (the <code>Tile(1, 1)</code> and the <code>anti-Tile(1, 1)</code>), This is because both the Hat and the Turtle transform into the spectre. If you start tilling with Hats and Turtles (no ani-Hats and no anti-Turtles):</p>\n<p><img alt=\"select hats and turtles\" class=\"medium-zoom-image\" data-src=\"https://www.nhatcher.com/images/hats/hats-and-turtles.png\" loading=\"lazy\" onerror=\"this.style.display='none'\" src=\"https://www.nhatcher.com/images/hats/hats-and-turtles.png\" title=\"Select Hats and Turtles\"/></p>\n<p><img alt=\"hats and turtles\" class=\"medium-zoom-image\" data-src=\"https://www.nhatcher.com/images/hats/hats-and-turtles-tiling.png\" loading=\"lazy\" onerror=\"this.style.display='none'\" src=\"https://www.nhatcher.com/images/hats/hats-and-turtles-tiling.png\" title=\"Hats and Turtles Tiling\"/></p>\n<p>and you transform them to Spectres you will end up with:</p>\n<p><img alt=\"spectres\" class=\"medium-zoom-image\" data-src=\"https://www.nhatcher.com/images/hats/hats-and-turtles-spectres.png\" loading=\"lazy\" onerror=\"this.style.display='none'\" src=\"https://www.nhatcher.com/images/hats/hats-and-turtles-spectres.png\" title=\"Spectres\"/></p>\n<p>Note that in this last image, all tiles are the same but with different orientations, there are no mirror images, and the tiling is aperiodic.</p>\n<h1 id=\"9-references\">9. References</h1>\n<p><a href=\"https://www.quantamagazine.org/math-that-goes-on-forever-but-never-repeats-20230523/\">quanta magazine</a></p>\n<p>Original sources:\n<a href=\"https://cs.uwaterloo.ca/~csk/hat/\">An aperiodic monotile</a>\n<a href=\"https://arxiv.org/abs/2305.17743\">A chiral aperiodic monotile</a></p>\n<p><a href=\"https://www.borealisai.com/research-blogs/tutorial-9-sat-solvers-i-introduction-and-applications/\">borealis tutorial</a></p>\n<p>Applications:</p>\n<p>Craig Kaplan:\n<a href=\"https://cs.uwaterloo.ca/~csk/hat/app.html\">patches of hats</a>\n<a href=\"https://cs.uwaterloo.ca/~csk/hat/h7h8.html\">H7/H8 substitution rules</a>\n<a href=\"https://github.com/isohedral/hatviz\">GitHub</a></p>\n<p><a href=\"https://mathigon.org/polypad/8kVqVH2Mor6JTQ\">Mathigon polypad</a></p>\n<p>SAT Solver online:\n<a href=\"https://msoos.github.io/cryptominisat_web/\">cryptominisat</a>\n<a href=\"https://github.com/msoos/cryptominisat\">GitHub</a></p>\n<p>Craig S. Kaplan uses this solver (Heesch Numbers of Unmarked Polyforms):\n<a href=\"https://isohedral.ca/heesch-numbers-of-unmarked-polyforms/\">blog post</a>\n<a href=\"https://arxiv.org/pdf/2105.09438.pdf\">paper</a></p>\n</div>\n<div class=\"post__footer\">\n</div>\n<div id=\"comment\">\n<h2>comments</h2>\n<div class=\"utterances\">\n<iframe class=\"utterances-frame\" loading=\"lazy\" scrolling=\"no\" src=\"https://utteranc.es/utterances.html?src=https%3A%2F%2Futteranc.es%2Fclient.js&amp;repo=nhatcher%2Fnhatcher.github.io&amp;issue-term=pathname&amp;theme=github-light&amp;crossorigin=anonymous&amp;async=&amp;url=https%3A%2F%2Fwww.nhatcher.com%2Fpost%2Fon-hats-and-sats%2F&amp;origin=https%3A%2F%2Fwww.nhatcher.com&amp;pathname=post%2Fon-hats-and-sats%2F&amp;title=Nicol%C3%A1s+Hatcher+%7C+The+Hat%2C+the+Spectre+and+SAT+solvers&amp;description=Software+developer+by+trade%2C+physicist+by+soul&amp;og%3Atitle=The+Hat%2C+the+Spectre+and+SAT+solvers&amp;session=\" title=\"Comments\"></iframe>\n</div>\n</div>\n</div>\n</main>", "article_metadata": {"title": "\nNicolás Hatcher\n|\nThe Hat, the Spectre and SAT solvers\n", "description": "Software developer by trade, physicist by soul", "og_image": ""}, "screenshot_path": "/static/screenshots/44269289.png", "screenshot_error": null, "hook": "Unveiling the \"Hat,\" a single shape that can tile a plane aperiodically—a feat previously thought impossible—this article explores this surprising mathematical discovery and its elegant solution using SAT solvers, a powerful yet often overlooked tool in computer science.  Learn how this unexpected connection bridges recreational mathematics and advanced algorithmic problem-solving, offering a unique blend of visual appeal and computational power.", "top_comments": [{"author": "kurthr", "text": "Interestingly, when firing your own, you could also make Supertiles from combinatorial collections of Penrose or other aperiodic tiles.", "depth": 0}, {"author": "gus_massa", "text": "Do you have some photos? It may be a nice post.", "depth": 1}, {"author": "nhatcher", "text": "Hey, thanks! Good luck with your Penrose tiles. I wish I had the time myself :)", "depth": 1}], "analysis": {"analysis": "**1. Summary:**\n\nThis blog post explores aperiodic tilings of the plane using a single monotile (\"the Hat\") and introduces SAT solvers as a powerful tool for solving such tiling problems.  The author demonstrates the application of SAT solvers through examples, including Sudoku and tiling with the Hat, and further introduces other aperiodic monotiles like the Turtle and Spectre.\n\n**2. Key Points:**\n\n* **Aperiodic Tiling:** The article focuses on the recent discovery of a single shape (\"the Hat\") capable of tiling the plane aperiodically, meaning it can cover the plane infinitely without repeating a pattern.  This contrasts with previous discoveries requiring multiple tiles.\n* **SAT Solvers:** The core of the article highlights the use of SAT (Satisfiability) solvers, a type of algorithm used to solve Boolean satisfiability problems, as a method for efficiently solving tiling problems.  The author explains how to adapt these solvers for this purpose.\n* **Practical Application:** The author provides practical examples, including a Sudoku solver and a tiling application using the Hat, demonstrating the versatility and power of SAT solvers.  He also introduces additional aperiodic monotiles (Turtle and Spectre) built upon the Hat.\n* **Code Availability:** The author makes the code used in the examples available on GitHub and provides links to online applications demonstrating the techniques discussed.\n\n\n**3. Discussion Highlights:**\n\nThe comments section is brief but reveals some interesting points:\n\n* **Comment 1 (kurthr):** This comment suggests an alternative approach to creating aperiodic tilings using supertiles constructed from combinatorial collections of existing aperiodic tiles (like Penrose tiles). This highlights the broader context of aperiodic tiling and suggests further avenues of exploration beyond the single monotile focus of the article.\n* **Comment 2 (gus_massa):** This comment requests visual aids (photos), indicating a desire for a more visually engaging presentation of the mathematical concepts. This suggests a potential improvement for future iterations of the article.\n* **Comment 3 (nhatcher):** The author's response acknowledges the suggestion and expresses a lack of time to pursue it. This offers a glimpse into the author's constraints and priorities.  The positive response to the suggestion, however, indicates a receptive attitude towards feedback.", "metadata": {"model": "gemini-1.5-flash", "content_length": 15000, "comments_analyzed": 3}}, "has_more": true}